<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control - C.S. y D. Constitución</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #f4f4f4; padding: 20px; margin: 0; }
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; display: flex; justify-content: center; align-items: center; z-index: 1000;
        }
        .login-box { background: white; padding: 30px; border-radius: 10px; text-align: center; width: 320px; }
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        .btn-login { background: #000; color: #ffd700; border: 2px solid #ffd700; width: 100%; padding: 12px; cursor: pointer; font-weight: bold; }
        
        #admin-content { display: none; max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h1 { border-bottom: 4px solid #ffd700; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #000; color: #ffd700; }
        .btn-delete { color: #ff4d4d; cursor: pointer; border: none; background: none; font-size: 1.2rem; }
        .foto-mini { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <img src="logo2.png" alt="Logo" style="width: 80px; margin-bottom: 15px;">
        <h2>ADMINISTRACIÓN</h2>
        <input type="text" id="user" placeholder="Usuario">
        <input type="password" id="pass" placeholder="Contraseña">
        <button class="btn-login" onclick="verificarAcceso()">ENTRAR</button>
    </div>
</div>

<div id="admin-content">
    <h1><i class="fas fa-users-cog"></i> Gestión de Socios - El Canario</h1>
    
    <div style="margin-top: 20px;">
        <button onclick="cargarSocios()" style="padding: 10px; cursor: pointer;">
            <i class="fas fa-sync"></i> Actualizar Lista
        </button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Foto</th>
                <th>Nombre</th>
                <th>DNI</th>
                <th>Categoría</th>
                <th>N° Socio</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tabla-socios">
            </tbody>
    </table>
</div>

<script>
    function verificarAcceso() {
        const u = document.getElementById('user').value;
        const p = document.getElementById('pass').value;

        if(u === "canario" && p === "123") {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';
            cargarSocios(); // Carga los datos apenas entra
        } else {
            alert("Acceso denegado");
        }
    }

    async function cargarSocios() {
        try {
            const res = await fetch('/api/socios');
            const socios = await res.json();
            const tabla = document.getElementById('tabla-socios');
            tabla.innerHTML = '';

            socios.forEach(s => {
                tabla.innerHTML += `
                    <tr>
                        <td><img src="${s.foto || 'placeholder.png'}" class="foto-mini"></td>
                        <td><strong>${s.nombre}</strong></td>
                        <td>${s.dni}</td>
                        <td>${s.categoria}</td>
                        <td>#${s.nro_socio}</td>
                        <td>
                            <button class="btn-delete" onclick="eliminarSocio(${s.id})">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>`;
            });
        } catch (e) {
            console.error("Error al cargar socios:", e);
        }
    }

    async function eliminarSocio(id) {
        if(!confirm("¿Estás seguro de eliminar este socio?")) return;
        
        try {
            const res = await fetch(`/api/socios/${id}`, { method: 'DELETE' });
            if(res.ok) {
                cargarSocios(); // Recarga la tabla
            }
        } catch (e) {
            alert("No se pudo eliminar");
        }
    }
</script>

</body>
</html>